#' Remove all artifacts generated by scripts
#'
#' Removes all output files generated by scripts in the pipeline, including
#' intermediate files. This provides a complete clean of generated artifacts.
#' The pipeline can be regenerated by running run() again.
#'
#' @param verbose Logical. If TRUE (default), prints progress messages
#'   to console.
#' @return Character vector of file paths that were actually removed
#' @export
#' @examples
#' # Copy sample project to temp directory
#' temp_dir <- tempfile()
#' dir.create(temp_dir)
#' sample_proj <- system.file("extdata", "sample-project", package = "bakepipe")
#' file.copy(sample_proj, temp_dir, recursive = TRUE)
#'
#' # Change to the sample project directory
#' old_wd <- getwd()
#' setwd(file.path(temp_dir, "sample-project"))
#'
#' # Run the pipeline first to create output files
#' run()
#'
#' # Now clean up the generated files
#' removed_files <- clean()
#' print(removed_files)
#'
#' # Restore working directory and clean up
#' setwd(old_wd)
#' unlink(temp_dir, recursive = TRUE)
clean <- function(verbose = TRUE) {
  deps <- parse()

  # Collect all output files
  files <- unique(unlist(lapply(deps$scripts, function(s) s$outputs)))

  # Add targets artifacts
  files <- c(files, "_targets.R")

  # Track removed files
  removed_files <- character()
  removed <- 0
  for (f in files) {
    if (file.exists(f)) {
      file.remove(f)
      removed_files <- c(removed_files, f)
      removed <- removed + 1
    }
  }

  # Remove _targets directory
  if (dir.exists("_targets")) {
    unlink("_targets", recursive = TRUE)
    removed <- removed + 1
  }

  if (verbose && removed > 0) {
    message(sprintf("âœ“ removed %d artifact%s", removed, if (removed != 1) "s" else ""))
  }

  invisible(removed_files)
}
